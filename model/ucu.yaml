#'////////////////////////////////////////////////////////////////////////////
#' FILE: ucu.yaml
#' AUTHOR: David Ruvolo
#' CREATED: 2022-05-11
#' MODIFIED: 2022-05-11
#' PURPOSE: EMX for the UCU database
#' STATUS: stable
#' PACKAGES: NA
#' COMMENTS: NA
#'////////////////////////////////////////////////////////////////////////////

name: ucu
label: Portal Unsolved Cases
date: 2022-05-11
version: 1.0.0

defaults:
  dataType: string
  idAttribute: false
  lookupAttribute: false
  nillable: true
  unique: false
  readOnly: false
  visible: true
  
entities:

  - name: patient
    label: Patient Requests
    attributes:
    
      - name: identifier
        dataType: string
        idAttribute: true
        labelAttribute: true
        lookupAttribute: true
        nillable: false
        readOnly: true
        unique: true

      - name: submitter
        label: Submitter (KG)
        dataType: string
        nillable: false
        
      - name: date
        label: Date submission
        dataType: date
        nillable: false

      - name: reason_submission
        label: Reason for submission
        dataType: text
        nillable: false

      - name: consent
        label: "Consent given by patient:"
        dataType: categorical
        refEntity: ucu_consent
        nillable: false

      - name: case
        label: Patient description
        dataType: compound

      - name: umcgidentifier
        label: UMCG ID
        description: UMCG nr
        dataType: xref
        refEntity: umdm_subjects
        nillable: false
        partOfAttribute: case

      - name: dnanr
        label: DNA number
        nillable: false
        dataType: xref
        refEntity: umdm_samples
        partOfAttribute: case

      - name: sex1
        label: Sex
        description: Sex at birth
        dataType: string
        expression: "{'template':'{{umcgidentifier.genderIdentity.value}}'}"
        nillable: false
        readOnly: true
        partOfAttribute: case

      - name: dateofBirth
        label: Date of birth
        description: Date of birth
        dataType: string
        expression: '{"template":"{{umcgidentifier.dateOfBirth}}"}'
        nillable: false
        readOnly: true
        partOfAttribute: case

      - name: phenotype
        label: Phenotype
        description: Phenotype (i.e., HPO term or HPO ID; multiple HPO entries possible)
        dataType: mref
        refEntity: umdm_lookups_phenotype
        nillable: true
        readOnly: true
        partOfAttribute: case

      - name: addPhenotype
        label: Additional phenotypic information
        dataType: text
        readOnly: true
        partOfAttribute: case

      - name: physical
        label: Physical examination
        dataType: text
        partOfAttribute: case

      - name: photos
        label: Photos (if available)
        dataType: file
        refEntity: sys_FileMeta
        partOfAttribute: case

      - name: EPICphoto
        label: Photos available in EPIC
        dataType: bool
        partOfAttribute: case

      - name: submitterPhoto
        label: Photos available from submitter
        dataType: bool
        partOfAttribute: case

      - name: addinfo
        label: Additional patient information
        dataType: text
        partOfAttribute: case

      - name: genetic_test
        label: Genetic tests UMCG
        description: (include test type, date of test)
        dataType: text
        partOfAttribute: case

      - name: genetic_testOther
        label: Genetics Tests elsewhere
        description: (include test type, date of test, where testing was done)
        dataType: text
        partOfAttribute: case

      - name: diagnosticsOther
        label: Other diagnostics of clinical importance
        dataType: text
        partOfAttribute: case

      - name: suspect
        label: Suspected variant/cause
        dataType: text
        partOfAttribute: case

      - name: sample_type
        label: Sample type(s)
        description: Which sample type(s) are available?
        dataType: categorical
        refEntity: ucu_sample_types
        partOfAttribute: case

      - name: sample_type_other
        label: If other, please specify
        dataType: text
        nillable: "{sample_type} !='6'"
        visible: "{sample_type} ='6'"
        partOfAttribute: case

      - name: addinfo_sample
        label: Additional sample/test Information
        dataType: text
        partOfAttribute: case

      - name: family
        label: Family information
        dataType: compound

      - name: fid
        label: FamilyID
        description: Family ID (FID)
        dataType: string
        expression: "{'template':'{{umcgidentifier.belongsToFamily}}'}"
        partOfAttribute: family

      - name: mid
        label: MaternalID
        description: "Maternal ID (MID), (when deceased, please fill: N/A)"
        dataType: string
        expression: "{'template':'{{umcgidentifier.belongsToMother.subjectID}}'}"
        partOfAttribute: family

      - name: pid
        label: PaternalID
        description: "Paternal ID (PID), (when deceased, please fill: N/A)"
        dataType: string
        expression: "{'template':'{{umcgidentifier.belongsToFather.subjectID}}'}"
        partOfAttribute: family

      - name: addinfo_family
        label: Additional family information
        dataType: text
        nillable: false
        partOfAttribute: family

      - name: status
        label: Status of the request
        description: Will be completed by the UCU team
        dataType: compound

      - name: status_info
        label: Status
        dataType: categorical
        refEntity: ucu_status
        partOfAttribute: status

      - name: datestatus
        label: Date changed status
        dataType: date
        partOfAttribute: status

      - name: reason
        label: reason status
        dataType: text
        partOfAttribute: status

  - name: technique
    label: Technique Requests
    attributes:
      - name: identifier
        dataType: string
        idAttribute: true
        labelAttribute: true
        lookupAttribute: true
        nillable: false
        readOnly: true
        unique: true

      - name: submitter
        label: Submitter (UMCG)
        dataType: string
        nillable: true

      - name: email_address
        label: Email address (UMCG)
        dataType: email
        nillable: false

      - name: date
        label: Date submission
        datType: date
        nillable: false

      - name: tech
        label: Technique description
        dataType: compound

      - name: summary
        label: Summary
        description: Brief description including preferred phenotype (use HPO terms), variant type (i.e., splicing, nonsense, mosaicism, etc.), newly published gene/phenotype association, UniParental Disomy (UPD), etc.
        dataType: text
        nillable: false
        partOfAttribute: tech

      - name: suitable
        label: Suitable for specific patients
        dataType: categorical
        refEntity: ucu_yesno
        nillable: false
        partOfAttribute: tech

      - name: suitableYes
        label: If yes, please specify
        dataType: text
        nillable: "{suitable} !='1'"
        visible: "{suitable} !='1'"
        partOfAttribute: tech

      - name: type
        label: Type technique
        dataType: categorical
        refEntity: ucu_type
        partOfAttribute: tech

      - name: sample_tech_other
        label: If other, please specify
        dataType: text
        nillable: "{type} !='6'"
        visible: "{type} !='6'"
        partOfAttribute: tech

      - name: sample_type
        label: Which sample/data type(s) is required?
        dataType: categorical
        refEntity: ucu_sample_types
        partOfAttribute: tech

      - name: sample_type_other
        label: If other, please specify
        dataType: text
        visible: "{sample_type} contains '6'"
        partOfAttribute: tech

      - name: data_file
        label: If a data file is required, what type of file is necessary?
        dataType: categorical
        refEntity: ucu_file
        partOfAttribute: tech

      - name: data_file_other
        label: If other, please specify
        dataType: text
        nillable: false
        visible: "{data_file} contains '5'"
        partOfAttribute: tech

      - name: stage
        label: Stage of development
        dataType: categorical
        refEntity: ucu_stage
        partOfAttribute: tech

      - name: addinfo
        label: Additional information over stage of development
        dataType: text
        partOfAttribute: tech

      - name: status
        label: Status of the request
        description: Will be completed by the UCU team
        dataType: compound

      - name: status_info
        label: Status
        dataType: categorical
        refEntity: ucu_status
        partOfAttribute: status

      - name: datestatus
        label: Date changed status
        dataType: date
        partOfAttribute: status

      - name: reason
        label: Reason status
        dataType: text
        partOfAttribute: status

  #////////////////////////////////////
  
  # Define Reference Entities
  
  - name: ref
    abstract: true
    attributes:
      - name: id
        dataType: string
        idAttribute: true
        lookupAttribute: true
        nillable: false
        readOnly: true
        unique: true

      - name: label
        dataType: string
        labelAttribute: true
        lookupAttribute: true
        nillable: false
        unique: false
  
  - name: consent
    extends: ucu_ref
    data:
      - id: 1
        label: Yes, signed document
      - id: 2
        label: Yes, verbal
      - id: 3
        label: Not yet
    
  - name: file
    extends: ucu_ref
    data:
      - id: 1
        label: VCF
      - id: 2
        label: FASTQ
      - id: 3
        label: BAM
      - id: 4
        label: TXT
      - id: 5
        label: Other
    
  - name: sample_types
    extends: ucu_ref
    data:
      - id: 1
        label: DNA
      - id: 2
        label: Fibroblasts
      - id: 3
        label: NGS exome data
      - id: 4
        label: RNA data
      - id: 5
        label: SNP array
      - id: 6
        label: Other
  
  - name: stage
    extends: ucu_ref
    data:
      - id: 1
        label: Concept (design) phase
      - id: 2
        label: Development phase
      - id: 3
        label: Test (beta) phase
      - id: 4
        label: Validation phase
      - id: 5
        label: Ready for production
  
  - name: status
    extends: ucu_ref
    data:
      - id: 1
        label: Accepted
      - id: 2
        label: Declined
      - id: 3
        label: Pending
  
  - name: type
    extends: ucu_ref
    data:
      - id: 1
        label: Software
      - id: 2
        label: Lab technique
      - id: 3
        label: New tool
      - id: 4
        label: Technique in development
      - id: 5
        label: Existing technique
      - id: 6
        label: Other
  
  - name: yesno
    extends: ucu_ref
    data:
      - id: 1
        label: Yes
      - id: 2
        label: No
  
        
  

  